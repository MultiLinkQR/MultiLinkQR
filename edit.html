<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit User - MultiLink QR Manager</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body>
  <div class="container">
    <div class="page-header">
      <h1 id="formTitle">âœï¸ Add New User</h1>
      <p class="subtitle">Fill in the platforms you use - leave others blank</p>
      <div id="adminLinks" class="admin-links hidden">
        <a href="index.html" class="btn-secondary">
          <span>ğŸ </span> Back to Dashboard
        </a>
      </div>
    </div>

    <form id="userForm">
      <!-- Basic Info -->
      <div class="form-section basic-info">
        <h3>ğŸ“ Basic Information <span class="platform-count">Required</span></h3>
        <input type="text" id="username" placeholder="Username (e.g., john-doe)" required>
        <small class="form-hint">ğŸ’¡ Multiple users can have the same username - User Code makes each one unique</small>
        <input type="text" id="fullname" placeholder="Full Name" required>
        <input type="text" id="userCode" placeholder="User Code (auto-generated)" readonly class="readonly-input">
        <small class="form-note">ğŸ”’ User Code is auto-generated and ensures uniqueness - This is what makes each user unique!</small>
      </div>

      <!-- Professional Networks -->
      <div class="form-section professional">
        <h3>ğŸ’¼ Professional & Business Networks <span class="platform-count">3</span></h3>
        <small>Career, business, and professional networking</small>
        <input type="url" id="linkedin" placeholder="LinkedIn - https://linkedin.com/in/username">
        <input type="url" id="xing" placeholder="Xing - https://xing.com/profile/username (Popular in Europe)">
        <input type="url" id="angellist" placeholder="AngelList - https://angel.co/u/username (Startups & Jobs)">
      </div>

      <!-- Creative & Design -->
      <div class="form-section design">
        <h3>ğŸ¨ Creative & Design Portfolios <span class="platform-count">4</span></h3>
        <small>Showcase your design work and creative projects</small>
        <input type="url" id="behance" placeholder="Behance - https://behance.net/username">
        <input type="url" id="dribbble" placeholder="Dribbble - https://dribbble.com/username">
        <input type="url" id="figma" placeholder="Figma - https://figma.com/@username">
        <input type="url" id="portfolio" placeholder="Adobe Portfolio - https://username.myportfolio.com">
      </div>

      <!-- Social Media -->
      <div class="form-section" class="form-section social">
        <h3>ğŸ“± Social Media Platforms <span class="platform-count">6</span></h3>
        <small>Popular social networking sites</small>
        <input type="url" id="instagram" placeholder="Instagram - https://instagram.com/username">
        <input type="url" id="twitter" placeholder="Twitter/X - https://twitter.com/username">
        <input type="url" id="facebook" placeholder="Facebook - https://facebook.com/username">
        <input type="url" id="threads" placeholder="Threads - https://threads.net/@username">
        <input type="url" id="mastodon" placeholder="Mastodon - https://mastodon.social/@username">
        <input type="url" id="bluesky" placeholder="BlueSky - https://bsky.app/profile/username">
      </div>

      <!-- Video Platforms -->
      <div class="form-section" class="form-section video">
        <h3>ğŸ¥ Video Platforms <span class="platform-count">4</span></h3>
        <small>Video sharing and live streaming</small>
        <input type="url" id="youtube" placeholder="YouTube - https://youtube.com/@username">
        <input type="url" id="tiktok" placeholder="TikTok - https://tiktok.com/@username">
        <input type="url" id="vimeo" placeholder="Vimeo - https://vimeo.com/username">
        <input type="url" id="twitch" placeholder="Twitch - https://twitch.tv/username">
      </div>

      <!-- Music & Audio -->
      <div class="form-section" class="form-section music">
        <h3>ğŸµ Music & Audio Platforms <span class="platform-count">4</span></h3>
        <small>Music streaming and audio content</small>
        <input type="url" id="spotify" placeholder="Spotify - Artist or Playlist URL">
        <input type="url" id="soundcloud" placeholder="SoundCloud - https://soundcloud.com/username">
        <input type="url" id="applemusic" placeholder="Apple Music - Artist URL">
        <input type="url" id="bandcamp" placeholder="Bandcamp - https://username.bandcamp.com">
      </div>

      <!-- Developer Platforms -->
      <div class="form-section" class="form-section developer">
        <h3>ğŸ’» Developer & Tech Communities <span class="platform-count">6</span></h3>
        <small>Code repositories and developer communities</small>
        <input type="url" id="github" placeholder="GitHub - https://github.com/username">
        <input type="url" id="gitlab" placeholder="GitLab - https://gitlab.com/username">
        <input type="url" id="bitbucket" placeholder="Bitbucket - https://bitbucket.org/username">
        <input type="url" id="stackoverflow" placeholder="Stack Overflow - Profile URL">
        <input type="url" id="devto" placeholder="Dev.to - https://dev.to/username">
        <input type="url" id="codepen" placeholder="CodePen - https://codepen.io/username">
      </div>

      <!-- Messaging & Communication -->
      <div class="form-section" class="form-section messaging">
        <h3>ğŸ’¬ Messaging & Communication <span class="platform-count">6</span></h3>
        <small>Chat apps and communication platforms</small>
        <input type="url" id="whatsapp" placeholder="WhatsApp - https://wa.me/1234567890">
        <input type="url" id="telegram" placeholder="Telegram - https://t.me/username">
        <input type="url" id="discord" placeholder="Discord - Username#1234 or Server Link">
        <input type="url" id="signal" placeholder="Signal - Username or Profile Link">
        <input type="url" id="skype" placeholder="Skype - Username or Profile Link">
        <input type="url" id="slack" placeholder="Slack - Workspace or Profile URL">
      </div>

      <!-- Gaming Platforms -->
      <div class="form-section" class="form-section gaming">
        <h3>ğŸ® Gaming Platforms <span class="platform-count">4</span></h3>
        <small>Gaming networks and profiles</small>
        <input type="url" id="steam" placeholder="Steam - https://steamcommunity.com/id/username">
        <input type="url" id="xbox" placeholder="Xbox - Gamertag or Profile URL">
        <input type="url" id="playstation" placeholder="PlayStation - PSN ID or Profile URL">
        <input type="url" id="nintendo" placeholder="Nintendo - Friend Code or Profile">
      </div>

      <!-- Creator & Monetization -->
      <div class="form-section" class="form-section creator">
        <h3>ğŸ’° Creator & Monetization <span class="platform-count">4</span></h3>
        <small>Support and subscription platforms</small>
        <input type="url" id="patreon" placeholder="Patreon - https://patreon.com/username">
        <input type="url" id="kofi" placeholder="Ko-fi - https://ko-fi.com/username">
        <input type="url" id="buymeacoffee" placeholder="Buy Me a Coffee - https://buymeacoffee.com/username">
        <input type="url" id="substack" placeholder="Substack - https://username.substack.com">
      </div>

      <!-- E-commerce & Shopping -->
      <div class="form-section" class="form-section ecommerce">
        <h3>ğŸ›’ E-Commerce & Shopping <span class="platform-count">3</span></h3>
        <small>Online stores and marketplaces</small>
        <input type="url" id="etsy" placeholder="Etsy - https://etsy.com/shop/shopname">
        <input type="url" id="amazon" placeholder="Amazon - Store or Author Page URL">
        <input type="url" id="shopify" placeholder="Shopify - https://yourstore.myshopify.com">
      </div>

      <!-- Photography & Visual Arts -->
      <div class="form-section" class="form-section photography">
        <h3>ğŸ“· Photography & Visual Arts <span class="platform-count">3</span></h3>
        <small>Photo sharing and portfolio sites</small>
        <input type="url" id="flickr" placeholder="Flickr - https://flickr.com/photos/username">
        <input type="url" id="500px" placeholder="500px - https://500px.com/p/username">
        <input type="url" id="unsplash" placeholder="Unsplash - https://unsplash.com/@username">
      </div>

      <!-- Blogging & Writing -->
      <div class="form-section" class="form-section blogging">
        <h3>âœï¸ Blogging & Writing <span class="platform-count">3</span></h3>
        <small>Blog and writing platforms</small>
        <input type="url" id="medium" placeholder="Medium - https://medium.com/@username">
        <input type="url" id="wordpress" placeholder="WordPress - https://username.wordpress.com">
        <input type="url" id="blogger" placeholder="Blogger - https://username.blogspot.com">
      </div>

      <!-- Other Social Platforms -->
      <div class="form-section" class="form-section misc-social">
        <h3>ğŸŒ Other Social Platforms <span class="platform-count">8</span></h3>
        <small>Additional social networks and trending platforms</small>
        <input type="url" id="pinterest" placeholder="Pinterest - https://pinterest.com/username">
        <input type="url" id="reddit" placeholder="Reddit - https://reddit.com/user/username">
        <input type="url" id="snapchat" placeholder="Snapchat - https://snapchat.com/add/username">
        <input type="url" id="tumblr" placeholder="Tumblr - https://username.tumblr.com">
        <input type="url" id="bereal" placeholder="BeReal - https://bere.al/username">
        <input type="url" id="clubhouse" placeholder="Clubhouse - https://clubhouse.com/@username">
        <input type="url" id="nextdoor" placeholder="Nextdoor - https://nextdoor.com/p/username">
        <input type="url" id="strava" placeholder="Strava - https://strava.com/athletes/username">
      </div>

      <!-- Productivity & Tools -->
      <div class="form-section" class="form-section productivity">
        <h3>ğŸ”§ Productivity & Tools <span class="platform-count">3</span></h3>
        <small>Useful tools and link aggregators</small>
        <input type="url" id="linktree" placeholder="Linktree - https://linktr.ee/username">
        <input type="url" id="notion" placeholder="Notion - Public Page URL">
        <input type="url" id="calendly" placeholder="Calendly - https://calendly.com/username">
      </div>

      <!-- Payment & Donation Platforms -->
      <div class="form-section payment">
        <h3>ğŸ’³ Payment & Donation Platforms <span class="platform-count">6</span></h3>
        <small>Payment links and UPI IDs. For multiple UPI IDs, separate with commas (e.g., id1@bank, id2@bank)</small>
        <input type="url" id="paypal" placeholder="PayPal - https://paypal.me/username">

        <div class="upi-input-group">
          <input type="text" id="gpay" placeholder="Google Pay UPI ID(s) - username@okaxis, username@paytm">
          <button type="button" class="add-upi-btn" data-target="gpay" title="Add another UPI ID">+</button>
        </div>

        <div class="upi-input-group">
          <input type="text" id="phonepe" placeholder="PhonePe UPI ID(s) - username@ybl, username@upi">
          <button type="button" class="add-upi-btn" data-target="phonepe" title="Add another UPI ID">+</button>
        </div>

        <div class="upi-input-group">
          <input type="text" id="paytm" placeholder="PayTM UPI ID(s) - username@paytm">
          <button type="button" class="add-upi-btn" data-target="paytm" title="Add another UPI ID">+</button>
        </div>

        <div class="upi-input-group">
          <input type="text" id="upi" placeholder="UPI ID(s) - username@bankname, username@paytm">
          <button type="button" class="add-upi-btn" data-target="upi" title="Add another UPI ID">+</button>
        </div>

        <input type="url" id="cashapp" placeholder="Cash App - https://cash.app/$username">
      </div>

      <!-- Business & Professional Tools -->
      <div class="form-section business">
        <h3>ğŸ¢ Business & Professional Tools <span class="platform-count">3</span></h3>
        <small>Professional business platforms</small>
        <input type="url" id="crunchbase" placeholder="Crunchbase - https://crunchbase.com/person/username">
        <input type="url" id="glassdoor" placeholder="Glassdoor - https://glassdoor.com/profile/username">
        <input type="url" id="indeed" placeholder="Indeed - https://indeed.com/profile/username">
      </div>

      <!-- Education & Learning -->
      <div class="form-section education">
        <h3>ğŸ“ Education & Learning <span class="platform-count">4</span></h3>
        <small>Educational and learning platforms</small>
        <input type="url" id="coursera" placeholder="Coursera - https://coursera.org/user/username">
        <input type="url" id="udemy" placeholder="Udemy - https://udemy.com/user/username">
        <input type="url" id="skillshare" placeholder="Skillshare - https://skillshare.com/user/username">
        <input type="url" id="khanacademy" placeholder="Khan Academy - https://khanacademy.org/profile/username">
      </div>

      <!-- Contact Information -->
      <div class="form-section contact">
        <h3>ğŸ“ Contact Information <span class="platform-count">4</span></h3>
        <small>Essential contact details. For multiple emails/phone numbers, separate with commas (e.g., email1@domain.com, email2@domain.com)</small>

        <div class="upi-input-group">
          <input type="text" id="email" placeholder="Email Address(es) - user@example.com, user@gmail.com" pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}([,\|\s]+[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})*" title="Enter email addresses separated by commas">
          <button type="button" class="add-upi-btn" data-target="email" title="Add another email address">+</button>
        </div>

        <div class="upi-input-group">
          <input type="text" id="phone" placeholder="Phone Number(s) - +1234567890, +1987654321" pattern="[\+]?[0-9]+([,\|\s]+[\+]?[0-9]+)*" title="Enter phone numbers separated by commas">
          <button type="button" class="add-upi-btn" data-target="phone" title="Add another phone number">+</button>
        </div>

        <input type="url" id="website" placeholder="Website - https://yourwebsite.com">
        <input type="url" id="menucard" placeholder="Menu Card - https://yourdigitalmenu.com or business card link">
        <input type="text" id="location" placeholder="Location - City, Country or Google Maps link">
        <input type="url" id="googleReview" placeholder="Google Review Link - https://maps.app.goo.gl/.../review">
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary">ğŸ’¾ Save User</button>
        <button type="button" class="btn-secondary" id="backBtn">â† Back to Dashboard</button>
      </div>
    </form>

    <div id="output" class="output-box hidden">
      <h3>âœ… Copy this JSON and add to data/clients.json:</h3>
      <textarea id="jsonOutput" readonly placeholder="User JSON data will appear here..."></textarea>
      <button class="btn-primary" id="copyBtn">ğŸ“‹ Copy to Clipboard</button>
    </div>
  </div>

  <script>
    // All supported platforms grouped by category
    const platformGroups = {
      professional: ['linkedin', 'xing', 'angellist'],
      design: ['behance', 'dribbble', 'figma', 'portfolio'],
      social: ['instagram', 'twitter', 'facebook', 'threads', 'mastodon', 'bluesky'],
      video: ['youtube', 'tiktok', 'vimeo', 'twitch'],
      music: ['spotify', 'soundcloud', 'applemusic', 'bandcamp'],
      developer: ['github', 'gitlab', 'bitbucket', 'stackoverflow', 'devto', 'codepen'],
      messaging: ['whatsapp', 'telegram', 'discord', 'signal', 'skype', 'slack'],
      gaming: ['steam', 'xbox', 'playstation', 'nintendo'],
      creator: ['patreon', 'kofi', 'buymeacoffee', 'substack'],
      ecommerce: ['etsy', 'amazon', 'shopify', 'flipkart'],
      photography: ['flickr', '500px', 'unsplash'],
      blogging: ['medium', 'wordpress', 'blogger'],
      miscSocial: ['pinterest', 'reddit', 'snapchat', 'tumblr', 'bereal', 'clubhouse', 'nextdoor', 'strava'],
      productivity: ['linktree', 'notion', 'calendly'],
      payment: ['paypal', 'gpay', 'phonepe', 'paytm', 'upi', 'cashapp'],
      business: ['crunchbase', 'glassdoor', 'indeed'],
      education: ['coursera', 'udemy', 'skillshare', 'khanacademy'],
      contact: ['email', 'phone', 'website', 'menucard', 'location', 'googleReview']
    };

    // Flatten all platforms into one array
    const allPlatforms = Object.values(platformGroups).flat();

    // Generate random code (internal helper)
    function generateRandomCode() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      const year = new Date().getFullYear();
      let code = '';
      for (let i = 0; i < 8; i++) {
        code += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return `${year}${code}`;
    }

    // Generate unique user code (checks against existing codes)
    async function generateUniqueUserCode() {
      try {
        // List of data files to check for existing codes
        const dataFiles = [
          './data/personal.json',
          './data/clients.json',
          // Add more files here as needed: './data/users_location2.json', etc.
        ];

        const allUsers = [];

        // Load users from all files to check for duplicates
        for (const file of dataFiles) {
          try {
            const res = await fetch(file);
            if (res.ok) {
              const users = await res.json();
              allUsers.push(...users);
            }
          } catch (fileErr) {
            console.log(`âš ï¸ Error loading ${file} for code check:`, fileErr.message);
            // Continue loading other files
          }
        }

        const existingCodes = allUsers.map(u => u.userCode).filter(c => c);

        // Keep generating until we get a unique code
        let code = generateRandomCode();
        let attempts = 0;
        const maxAttempts = 100; // Prevent infinite loop

        while (existingCodes.includes(code) && attempts < maxAttempts) {
          console.log(`Code ${code} already exists, generating new one...`);
          code = generateRandomCode();
          attempts++;
        }

        if (attempts >= maxAttempts) {
          console.warn('Max attempts reached, using timestamp suffix');
          code = generateRandomCode() + Date.now().toString().slice(-3);
        }

        console.log(`âœ… Generated unique code: ${code}`);
        return code;
      } catch (err) {
        console.error('Error checking existing codes:', err);
        // Fallback: generate with timestamp to ensure uniqueness
        return generateRandomCode() + Date.now().toString().slice(-3);
      }
    }

    // Auto-generate user code on page load (for new users)
    window.addEventListener('DOMContentLoaded', async () => {
      const params = new URLSearchParams(window.location.search);
      const username = params.get('user');

      // Only generate if it's a new user (no username in URL)
      if (!username) {
        const uniqueCode = await generateUniqueUserCode();
        document.getElementById('userCode').value = uniqueCode;
      }
    });

    // Load existing user for editing
    async function loadUser() {
      const params = new URLSearchParams(window.location.search);
      const username = params.get('user');
      const userCode = params.get('code');
      if (!username) return;

      try {
        // List of data files to search
        const dataFiles = [
          './data/personal.json',
          './data/clients.json',
          // Add more files here as needed: './data/users_location2.json', etc.
        ];

        let user = null;

        // Search for user across all data files
        for (const file of dataFiles) {
          try {
            const res = await fetch(file);
            if (res.ok) {
              const users = await res.json();

              // Find user by both username AND userCode (handles duplicate usernames)
              if (userCode) {
                // If userCode provided, match both username and code
                user = users.find(u => u.username === username && u.userCode === userCode);
              } else {
                // Fallback: match by username only (for backward compatibility)
                user = users.find(u => u.username === username);
              }

              if (user) {
                console.log(`âœ… Found user in ${file}`);
                break; // Stop searching once user is found
              }
            }
          } catch (fileErr) {
            console.log(`âš ï¸ Error searching ${file}:`, fileErr.message);
            // Continue searching other files
          }
        }

        if (!user) return;

        document.getElementById('formTitle').innerText = "âœï¸ Edit User";
        document.getElementById('username').value = user.username;
        document.getElementById('username').disabled = true;
        document.getElementById('fullname').value = user.fullname;

        // Use existing code or generate new unique one if missing
        if (user.userCode) {
          document.getElementById('userCode').value = user.userCode;
        } else {
          const uniqueCode = await generateUniqueUserCode();
          document.getElementById('userCode').value = uniqueCode;
        }

        // Load all platform values
        allPlatforms.forEach(platform => {
          const input = document.getElementById(platform);
          if (input && user[platform]) {
            input.value = user[platform];
          }
        });
      } catch (err) {
        console.error("Error loading user:", err);
      }
    }

    document.getElementById('backBtn').onclick = () => {
      window.location.href = "index.html";
    };

    document.getElementById('userForm').onsubmit = async (e) => {
      e.preventDefault();

      const usernameInput = document.getElementById('username').value;
      const normalizedUsername = usernameInput.trim().toLowerCase().replace(/\s+/g, '-');

      const data = {
        username: normalizedUsername,
        fullname: document.getElementById('fullname').value.trim(),
        userCode: document.getElementById('userCode').value.trim()
      };

      // Add comment headers for organization
      data._comment_professional = "=== PROFESSIONAL & BUSINESS NETWORKS ===";
      platformGroups.professional.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_design = "=== CREATIVE & DESIGN PORTFOLIOS ===";
      platformGroups.design.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_social = "=== SOCIAL MEDIA PLATFORMS ===";
      platformGroups.social.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_video = "=== VIDEO PLATFORMS ===";
      platformGroups.video.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_music = "=== MUSIC & AUDIO PLATFORMS ===";
      platformGroups.music.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_developer = "=== DEVELOPER & TECH COMMUNITIES ===";
      platformGroups.developer.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_messaging = "=== MESSAGING & COMMUNICATION ===";
      platformGroups.messaging.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_gaming = "=== GAMING PLATFORMS ===";
      platformGroups.gaming.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_creator = "=== CREATOR & MONETIZATION ===";
      platformGroups.creator.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_ecommerce = "=== E-COMMERCE & SHOPPING ===";
      platformGroups.ecommerce.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_photography = "=== PHOTOGRAPHY & VISUAL ARTS ===";
      platformGroups.photography.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_blogging = "=== BLOGGING & WRITING ===";
      platformGroups.blogging.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_misc_social = "=== OTHER SOCIAL PLATFORMS ===";
      platformGroups.miscSocial.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_productivity = "=== PRODUCTIVITY & TOOLS ===";
      platformGroups.productivity.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_payment = "=== PAYMENT & DONATION PLATFORMS ===";
      platformGroups.payment.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_business = "=== BUSINESS & PROFESSIONAL TOOLS ===";
      platformGroups.business.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_education = "=== EDUCATION & LEARNING ===";
      platformGroups.education.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      data._comment_contact = "=== CONTACT INFORMATION ===";
      platformGroups.contact.forEach(p => data[p] = document.getElementById(p)?.value.trim() || "");

      // Format JSON with proper line breaks and spacing for better readability
      const jsonOutput = JSON.stringify(data, null, 2)
        .replace(/,\n  "_comment_/g, ',\n\n  "_comment_')  // Add extra line break before comment sections
        .replace(/,\n  "username"/g, ',\n\n  "username"')  // Add extra line break before username
        .replace(/,\n  "fullname"/g, ',\n  "fullname"')   // Keep normal spacing for fullname
        .replace(/,\n  "userCode"/g, ',\n  "userCode"');   // Keep normal spacing for userCode

      document.getElementById('jsonOutput').value = jsonOutput;
      document.getElementById('output').style.display = 'block';

      document.getElementById('output').scrollIntoView({ behavior: 'smooth' });
    };

    document.getElementById('copyBtn').onclick = () => {
      const textarea = document.getElementById('jsonOutput');
      textarea.select();
      document.execCommand('copy');

      const btn = document.getElementById('copyBtn');
      const originalText = btn.innerHTML;
      btn.innerHTML = 'âœ… Copied!';
      setTimeout(() => {
        btn.innerHTML = originalText;
      }, 2000);
    };

    // Input sanitization function
    function sanitizeInput(input) {
      if (typeof input !== 'string') return '';
      return input.replace(/[<>\"'&]/g, function(match) {
        const escapeMap = {
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#x27;',
          '&': '&amp;'
        };
        return escapeMap[match];
      });
    }

    // Check if user is authenticated and show admin links
    function checkAdminStatus() {
      const isAuthenticated = sessionStorage.getItem('adminAuthenticated');
      const loginTime = sessionStorage.getItem('adminLoginTime');

      if (isAuthenticated && loginTime) {
        const sessionAge = Date.now() - parseInt(loginTime);
        const maxSessionAge = 24 * 60 * 60 * 1000; // 24 hours

        if (sessionAge <= maxSessionAge) {
          // Show admin links
          document.getElementById('adminLinks').style.display = 'block';
        }
      }
    }

    // Load user data (no authentication required for this page)
    loadUser();

    // Check admin status
    checkAdminStatus();

    // Handle multiple UPI IDs functionality
    function setupUPIInputGroups() {
      document.querySelectorAll('.add-upi-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const targetId = this.dataset.target;
          const input = document.getElementById(targetId);
          const currentValue = input.value.trim();

          if (currentValue) {
            // If there's already content, add a comma and focus
            if (!currentValue.endsWith(',')) {
              input.value = currentValue + ', ';
            }
          } else {
            // If empty, add placeholder text
            input.placeholder = input.placeholder.replace('UPI ID(s)', 'UPI ID');
          }

          input.focus();
          input.setSelectionRange(input.value.length, input.value.length);
        });
      });
    }

    // Initialize UPI input groups when DOM is loaded
    document.addEventListener('DOMContentLoaded', setupUPIInputGroups);
  </script>
</body>

</html>